function x = SO3_RotateVector(q, X)

b = zeros(3, 1);
for i = 1:3
    b(i, :) = q(1) * q(i+1);
end

c_inds = [[1,1]; [2,2]; [3,3]; [1,2]; [1,3]; [2,3]];
c = zeros(6, 1);
for i = 1:6
    ij = c_inds(i, :);
    c(i) = q(ij(1)+1) * q(ij(2)+1);
end

n_cols = size(X, 2);
x = zeros(3, n_cols);	
x(1, :) = X(1, :) + 2.0 * ((-c(2) - c(3)) * X(1, :) + (c(4) - b(3)) * X(2, :) + (c(5) + b(2)) * X(3, :));
x(2, :) = X(2, :) + 2.0 * ((c(4) + b(3)) * X(1, :) + (-c(1) - c(3)) * X(2, :) +  (c(6) - b(1)) * X(3, :));
x(3, :) = X(3, :) + 2.0 * ((c(5) - b(2)) * X(1, :) +  (c(6) + b(1)) * X(2, :) + (-c(1) - c(2)) * X(3, :));

end